<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Page - Profit/Loss</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f4f4f4; }
        .container { width: 80%; margin: auto; background: white; padding: 20px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: center; }
        th { background-color: #4CAF50; color: white; }
    </style>
</head>
<body style="background-image: url('images/Form.jpeg'); background-size: cover; background-position: center; background-repeat: no-repeat; height: 100vh;"></body>
<body>
    <div class="container">
        <h2>Profit/Loss Data for Selected Crop</h2>
        <h3 id="cropName">Crop: </h3>
        <table id="profitLossTable">
            <thead>
                <tr>
                    <th>Crop</th>
                    <th>Date</th>
                    <th>Price (₹)</th>
                    <th>Previous Date</th>
                    <th>Previous Price (₹)</th>
                    <th>Profit/Loss (₹)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script>
        // Get the query parameters from the URL
        const queryParams = new URLSearchParams(window.location.search);
        const selectedCrop = queryParams.get('crop');
        const selectedCropData = JSON.parse(queryParams.get('data'));

        // Display the selected crop name
        document.getElementById("cropName").innerText = `Crop: ${selectedCrop}`;

        // Function to calculate profit/loss and populate the table
        function populateProfitLossTable() {
            const tableBody = document.querySelector("#profitLossTable tbody");
            tableBody.innerHTML = "";  // Clear existing table data

            selectedCropData.forEach((row, index, arr) => {
                const previousDay = index > 0 ? arr[index - 1] : null;
                const previousDate = previousDay ? previousDay.date : '-';
                const previousPrice = previousDay ? previousDay.price : '-';
                const profitLoss = previousDay ? row.price - previousDay.price : 0;

                tableBody.innerHTML += `<tr>
                    <td>${row.crop}</td>
                    <td>${row.date}</td>
                    <td>${row.price}</td>
                    <td>${previousDate}</td>
                    <td>${previousPrice}</td>
                    <td>${profitLoss}</td>
                </tr>`;
            });
        }

        // Function to generate Excel file
        function generateExcel() {
            const ws = XLSX.utils.table_to_sheet(document.getElementById('profitLossTable'));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Profit/Loss Data");

            XLSX.writeFile(wb, `${selectedCrop}_profit_loss.xlsx`);
        }

        
        // Populate the table with the selected crop data
        populateProfitLossTable();
    </script>
</body>
</html>